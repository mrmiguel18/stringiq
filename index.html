<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StringIQ</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#111111" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>

  <div id="authScreen" class="wrap" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 90vh;">
    <section class="card" style="width: 100%; max-width: 400px; text-align: center;">
      <h1 style="margin-bottom: 5px;">StringIQ</h1>
      <p style="margin-bottom: 25px; color: var(--muted);">Authorized Personnel Only</p>
      
      <form id="loginForm" onsubmit="return false;" style="display: flex; flex-direction: column; gap: 12px;">
        <input id="loginEmail" type="email" name="email" autocomplete="username" placeholder="Email" required />
        <input id="loginPass" type="password" name="password" autocomplete="current-password" placeholder="Password" required />
        
        <div class="row">
          <button type="submit" onclick="handleEmailLogin()" class="btn primary" style="flex:1">Login</button>
          <button type="button" onclick="handleEmailSignUp()" class="btn" style="flex:1">Sign Up</button>
        </div>
      </form>
      
      <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--line);" />
      
      <button onclick="handleGoogleLogin()" class="btn" style="width: 100%; background: white; color: #444; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px;">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18">
        Sign in with Google
      </button>
    </section>
  </div>

  <div id="appContent" style="display: none;">
    <header class="topbar">
      <div class="row space">
        <div>
          <h1>StringIQ</h1>
          <p class="sub">Player profiles + setups</p>
        </div>
        <button onclick="handleLogout()" class="btn" style="padding: 5px 12px; font-size: 12px; background: #ff4b4b; color: white; border:none;">Logout</button>
      </div>
    </header>

    <main class="wrap">
      <aside id="toolbox" class="card" style="margin-bottom: 20px; border: 1px solid var(--line);">
        <h3 style="font-size: 14px; text-transform: uppercase; color: var(--muted); margin-bottom: 15px;">Toolbox</h3>
        <div class="tool-section" style="margin-bottom: 15px;">
          <label><span>Tension Loss Predictor</span></label>
          <input type="date" id="stringingDate" onchange="calculateTensionLoss()" style="margin-top: 5px;">
          <div id="tensionResult" style="margin-top: 8px; font-size: 13px; font-weight: bold; padding: 10px; background: #f9f9f9; border-radius: 8px;">
            Select date to see loss %
          </div>
        </div>
        <div id="adminLink" style="display: none; border-top: 1px solid var(--line); padding-top: 15px;">
          <button class="btn primary" onclick="openAdminDashboard()" style="width: 100%; font-size: 12px;">Admin Dashboard</button>
        </div>
      </aside>

      <section class="card">
        <h2>Create / Edit Player</h2>
        <form id="playerForm" class="form">
          <input type="hidden" id="playerId" />
          
          <div class="row">
            <label style="flex: 2;">
              <span>Name</span>
              <input id="name" required placeholder="Player Name" />
            </label>
            <label style="flex: 1;">
              <span>Age</span>
              <input id="age" type="number" placeholder="--" />
            </label>
          </div>

          <div class="row">
            <label style="flex: 1;">
              <span>UTR</span>
              <input id="utr" type="number" step="0.1" placeholder="0.0" />
            </label>
            <label style="flex: 1;">
              <span>Hand</span>
              <select id="hand">
                <option value="Right">Right</option>
                <option value="Left">Left</option>
              </select>
            </label>
          </div>

          <hr style="border: 0; border-top: 1px solid var(--line); margin: 20px 0;" />
          <h3 style="font-size: 14px; text-transform: uppercase; color: var(--muted); margin-bottom: 10px;">Racket Setup</h3>
          
          <div class="row">
            <label style="flex: 2;">
              <span>Racket Model</span>
              <select id="racketModel" required></select>
            </label>
            <label style="flex: 1;">
              <span>Pattern</span>
              <select id="pattern">
                <option value="16x19">16x19</option>
                <option value="18x20">18x20</option>
                <option value="16x18">16x18</option>
              </select>
            </label>
          </div>

          <div class="row">
            <label style="flex: 1;"><span>Main String</span><select id="stringMain" required></select></label>
            <label style="flex: 1;"><span>Cross String</span><select id="stringCross" required></select></label>
          </div>

          <div class="row">
            <label style="flex: 1;"><span>Main lbs</span><select id="tensionMain"></select></label>
            <label style="flex: 1;"><span>Cross lbs</span><select id="tensionCross"></select></label>
          </div>

          <hr style="border: 0; border-top: 1px solid var(--line); margin: 20px 0;" />
          <h3 style="font-size: 14px; text-transform: uppercase; color: var(--muted); margin-bottom: 10px;">Performance & Feel</h3>
          
          <div class="row">
            <label style="flex: 1;">
                <span>Setup Rating (0-100)</span>
                <input id="setupRating" type="number" min="0" max="100" placeholder="85" />
            </label>
            <label style="flex: 1;">
                <span>Weekly Feeling (1-100)</span>
                <input id="weeklyFeeling" type="number" min="1" max="100" placeholder="50" />
            </label>
          </div>

          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 15px 0; background: #f0f4ff; padding: 10px; border-radius: 8px; border: 1px dashed #4b79ff;">
            <input type="checkbox" id="usedBallMachine" style="width: 20px; height: 20px; margin: 0;">
            <span style="font-size: 11px; font-weight: bold; color: #4b79ff; line-height: 1.2;">
              Did you practice with a ball machine prior to inputting weekly feeling score?
            </span>
          </label>

          <label><span>Notes</span><textarea id="notes" rows="3" placeholder="Add custom notes here..."></textarea></label>

          <div class="row" style="margin-top: 20px;">
            <button type="submit" class="btn primary" style="flex: 2;">Save Profile</button>
          </div>
        </form>
      </section>

      <section class="card">
        <div class="row space">
          <h2>Players</h2>
          <div class="row" style="margin-top: 0;">
            <input id="search" placeholder="Search..." style="width: 120px; margin-top:0;" />
            <select id="sortBy" style="width: 110px; margin-top:0; padding: 10px;">
              <option value="name">A-Z</option>
              <option value="newest">Recent</option>
              <option value="ratingHigh">Rating (High)</option>
              <option value="ratingLow">Rating (Low)</option>
            </select>
          </div>
        </div>
        <div id="playerList" class="list"></div>
        <p id="empty" class="empty">No players yet</p>
      </section>
    </main>
  </div> 

  <div id="iosPrompt" style="display:none; position:fixed; bottom:20px; left:20px; right:20px; background:white; color:#333; padding:20px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.3); z-index:9999; border: 2px solid #4b79ff;">
    <h4 style="margin-bottom:10px;">Install on iPhone</h4>
    <p style="font-size:14px; margin-bottom:15px;">1. Tap the <strong>Share</strong> icon (square with arrow) at the bottom.<br>2. Scroll down and tap <strong>Add to Home Screen</strong>.</p>
    <button onclick="document.getElementById('iosPrompt').style.display='none'" class="btn primary" style="width:100%;">Got it!</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="./app.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js")
        .then(() => console.log("Service Worker Registered"))
        .catch(err => console.log("SW Registration Failed", err));
    }
  </script>
</body>
</html>
